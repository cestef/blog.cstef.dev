---
import { HIDE_SEED_IN_PROD } from "@/constants";
import Prose from "@/layouts/Prose.astro";
import RootLayout from "@/layouts/RootLayout.astro";
import { getCollection } from "astro:content";

const isProd = import.meta.env.PROD;
const posts = (await getCollection("blog"))
	.filter((e) => (isProd && HIDE_SEED_IN_PROD ? e.data.growth !== "seed" : true))
	.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const postsByYear = posts.reduce(
	(acc, post) => {
		const year = post.data.date.getFullYear();
		if (!acc[year]) {
			acc[year] = [];
		}
		acc[year].push(post);
		return acc;
	},
	{} as Record<number, typeof posts>
);
---

<RootLayout path="/posts">
	<Prose>
		<h1>Posts</h1>
		{
			Object.entries(postsByYear).map(([year, posts]) => (
				<section>
					<h2>{year}</h2>
					<ul>
						{posts.map((post) => (
							<li>
								<a
									href={`/posts/${post.slug}`}
									class="underline-offset-2 decoration-2"
								>{post.data.title.trim()}</a><span class="text-muted-foreground"> ({post.data.date.toLocaleDateString()})</span>
							</li>
						))}
					</ul>
				</section>
			))
		}
	</Prose>
</RootLayout>
